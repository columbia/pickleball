FROM pickleball-enforce:latest

RUN apt-get update && apt-get install -y git

#RUN pip install packaging wheel
#RUN pip install FlagEmbedding peft
WORKDIR /
RUN git clone https://github.com/FlagOpen/FlagEmbedding.git
WORKDIR /FlagEmbedding
RUN pip install .
RUN pip install transformers==4.46.1

# Relative to the evaluation directory
COPY ./enforcement/utils/modeling_utils.patch /root/modeling_utils.patch
COPY ./enforcement/utils/flagembedding.patch /root/flagembedding.patch
RUN cd /root && patch -p1 < /root/modeling_utils.patch
RUN cd /root && patch -p1 < /root/flagembedding.patch
